plugins {
    id 'application'
    id "org.jetbrains.kotlin.jvm"
}

application {
    mainClassName = 'com.koupper.octopus.OctopusKt'
}

jar {
    manifest {
        attributes 'Main-Class': 'com.koupper.octopus.OctopusKt'
    }
    from {
        configurations.runtimeClasspath.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }
}

task optimized(type: Jar) {
    group = "custom-task"
    description = "Generate an optimized Octopus jar."
    manifest {
        attributes 'Main-Class': 'com.koupper.octopus.OctopusKt'
    }
    from sourceSets.main.output
    from {
        configurations.runtimeClasspath.filter {
            it.name.contains("container") || it.name.contains("providers")
        }.collect {
            println("including: ${it.name} to optimized Octopus process manager.")
            it.isDirectory() ? it : zipTree(it)
        }
    }
    doLast {
        println("Optimized Octopus generated.")
    }
}
